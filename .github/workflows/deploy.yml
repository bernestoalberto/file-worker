on:
 push:
  branches: 
    - main
jobs:
   run_pull:
      name: run pull
      runs-on: ubuntu-latest

      steps:
      - name: Write SSH keys
        run: |
         install -m 600 -D /dev/null ~/.ssh/id_rsa
         echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
         host='${{secrets.SSH_HOST}}'
         hosts="$(dig +short "$host" | grep -v '\.$' | sed -z 's|\n|,|g')$host"
         ssh-keyscan -H "$hosts" > ~/.ssh/known_hosts
      - name: connect and pull
        run: ssh ${{secrets.SSH_USER}}@${{secrets.SSH_HOST}} "cd ${{secrets.WORK_DIR}}" && git checkout ${{secrets.MAIN_BRANCH}} && git pull 
      - name: cleanup  
        run: rm -rf ~/.ssh
       
           
           
